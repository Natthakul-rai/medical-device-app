<div class="devices-container page-shell">
  <div class="section-header">
    <div>
      <h2>การจัดการอุปกรณ์ห้องแล็บ</h2>
      <p class="section-lead">ดูรายละเอียด เพิ่ม และอัปเดตสถานะอุปกรณ์ห้องแล็บได้จากที่นี่</p>
    </div>
    <div class="section-actions">
      <button mat-flat-button color="primary" class="cta" (click)="addDevice()">
        <mat-icon>add_circle</mat-icon>
        เพิ่มอุปกรณ์ห้องแล็บใหม่
      </button>
    </div>
  </div>

  <div class="filters surface-card" [formGroup]="filterGroup">
    <mat-form-field appearance="outline">
      <mat-label>ค้นหา</mat-label>
      <input matInput formControlName="search" (input)="onFilterChange()" placeholder="ชื่อ, หมายเลข, หมายเลขซีเรียล, หน่วยงาน, หมวดหมู่" />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>สถานะ</mat-label>
      <mat-select formControlName="status" (selectionChange)="onFilterChange()">
        <mat-option value="all">ทั้งหมด</mat-option>
        <mat-option *ngFor="let option of statusOptions" [value]="option.value">
          {{ option.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="table-wrapper surface-table">
    <table mat-table [dataSource]="filteredDevices()" [trackBy]="trackById">
      <ng-container matColumnDef="qr">
        <th mat-header-cell *matHeaderCellDef>QR</th>
        <td mat-cell *matCellDef="let device">
          <button mat-icon-button color="primary" matTooltip="แสดง QR Code" (click)="showQRCode(device)">
            <mat-icon>qr_code</mat-icon>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>ชื่ออุปกรณ์</th>
        <td mat-cell *matCellDef="let device">
          <div class="device-name">{{ device.name }}</div>
          <div class="device-meta">{{ device.location }}</div>
        </td>
      </ng-container>

      <ng-container matColumnDef="code">
        <th mat-header-cell *matHeaderCellDef>หมายเลขอุปกรณ์</th>
        <td mat-cell *matCellDef="let device">{{ device.code }}</td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>สถานะ</th>
        <td mat-cell *matCellDef="let device">
          <span [class]="statusClass(device.status)">
            {{ statusLabel(device.status) }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="addedAt">
        <th mat-header-cell *matHeaderCellDef>วันที่เพิ่ม</th>
        <td mat-cell *matCellDef="let device">{{ device.createdAt | date: 'd MMM yyyy' }}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="actions-column">การจัดการ</th>
        <td mat-cell *matCellDef="let device" class="actions-column">
          <button mat-icon-button color="primary" matTooltip="ดูรายละเอียด" (click)="viewDetail(device)">
            <mat-icon>visibility</mat-icon>
          </button>
          <button mat-icon-button color="accent" matTooltip="แก้ไข" (click)="editDevice(device)">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" matTooltip="ลบ" (click)="deleteDevice(device)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columns"></tr>
      <tr mat-row *matRowDef="let row; columns: columns"></tr>
      <tr class="empty" *ngIf="filteredDevices().length === 0">
        <td colspan="6">
          <mat-icon>inventory_2</mat-icon>
          <p>ไม่พบอุปกรณ์ที่ตรงกับเงื่อนไข</p>
        </td>
      </tr>
    </table>
  </div>
</div>
